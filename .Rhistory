library(dplyr)
library(tidyverse)
library(survival)
library(survminer)
options(scipen = 999)
master = read_csv("Master.csv")
batters = read_csv("Batting.csv")
head(master)
master =
master %>%
select(playerID, nameFirst, nameLast, nameGiven, weight, height, bats, throws, debut, finalGame)
master =
master %>%
mutate(finalGame = substr(finalGame, 0, 4)) %>%
mutate(debut = substr(debut, 0, 4))
head(master)
batters =
batters %>% group_by(playerID) %>%
summarise(cG = sum(G), cAB = sum(AB), cR = sum(R), cH = sum(H), cRBI = sum(RBI), cSB = sum(SB), cSO = sum(SO), LastYear = max(yearID))
head(batters)
data = master %>% left_join(batters)
head(data)
data = data %>%
filter(!is.na(weight), !is.na(height), !is.na(bats), !is.na(throws), !is.na(debut), !is.na(finalGame), !is.na(cG), !is.na(cAB), !is.na(cAB),
!is.na(cR), !is.na(cH), !is.na(cRBI), !is.na(cSB), !is.na(cSO), !is.na(LastYear))
data = data %>%
mutate(isIn = ifelse(LastYear > 2015, 1, 0))
playersIn = data %>%
filter(isIn == 1)
playersOut = data %>%
filter(isIn == 0)
library(tidyverse)
library(survival)
managers = read_csv("managerssurvival.csv")
setwd("~/USMA/Academics/Cow2/MA388")
managers = read_csv("managerssurvival.csv")
head(managers)
names(managers)
managers = managers %>%
mutate(PercentLast1 = W.x/G.x) %>%
select(playerID, totalseasons, censor, divID, lgID.x, PercentLast1, PercentLast2, PercentLast3, totalwins, totalavgrank, totalseasons, totalloss, franchID, R,	AB,	H,	`2B`,	`3B`,	HR,	BB,	SO,	SB,	CS,	RA,	ER,	ERA,	CG,	SHO,	SV,	IPouts,	HA,	HRA,	BBA,	SOA,	E,	DP,	FP, attendance, startyear) %>%
filter(startyear >1950)
managers = managers[1:469,] ## only coaches with divID
head(managers)
names(managers)
survobj = Surv(managers$totalseasons,managers$censor)
survobj
km = survfit(survobj~1)
summary(km)
##plot KM curve
plot(km, conf.int = TRUE)
## Fit First Model
cox1 = coxph(survobj~ divID + lgID.x + totalwins + PercentLast1, data = managers)
summary(cox1)
plot(survfit(cox1), conf.int = TRUE)
## Fit Second Model
cox2 = coxph(survobj~ strata(divID) + lgID.x + totalwins + PercentLast1, data = managers)
summary(cox2)
plot(survfit(cox2), conf.int = TRUE)
plot(cox.zph(cox1)) ## Systematic departures from a horizontal line are indicative of non-proportional hazards.
cox.zph(cox1) ## low p values indicate very non proportional hazards and a violation of our assumption
cox3 = coxph(survobj~ divID, data = managers)
summary(cox3)
plot(survfit(cox3), conf.int = TRUE)
plot(survfit(cox3), conf.int = TRUE)
setwd("~/USMA/Academics/Cow2/MA388/Project/ma388project")
##plot KM curve
plot(km, conf.int = TRUE)
survobj
batters =
batters %>% group_by(playerID) %>%
summarise(cG = sum(G), cAB = sum(AB), cR = sum(R), cH = sum(H), cRBI = sum(RBI), cSB = sum(SB), cSO = sum(SO), LastYear = max(yearID), totalSeasons = sum(!is.na(playerID)))
library(dplyr)
library(tidyverse)
library(survival)
library(survminer)
options(scipen = 999)
master = read_csv("Master.csv")
batters = read_csv("Batting.csv")
master =
master %>%
select(playerID, nameFirst, nameLast, nameGiven, weight, height, bats, throws, debut, finalGame)
master =
master %>%
mutate(finalGame = substr(finalGame, 0, 4)) %>%
mutate(debut = substr(debut, 0, 4))
head(master)
batters =
batters %>% group_by(playerID) %>%
summarise(cG = sum(G), cAB = sum(AB), cR = sum(R), cH = sum(H), cRBI = sum(RBI), cSB = sum(SB), cSO = sum(SO), LastYear = max(yearID), totalSeasons = sum(!is.na(playerID)))
head(batters)
data = master %>% left_join(batters)
head(data)
data = data %>%
filter(!is.na(weight), !is.na(height), !is.na(bats), !is.na(throws), !is.na(debut), !is.na(finalGame), !is.na(cG), !is.na(cAB), !is.na(cAB),
!is.na(cR), !is.na(cH), !is.na(cRBI), !is.na(cSB), !is.na(cSO), !is.na(LastYear))
data = data %>%
mutate(isIn = ifelse(LastYear > 2015, 0, 1))
playersIn = data %>%
filter(isIn == 0)
playersOut = data %>%
filter(isIn == 1)
object = Surv(data$totalSeasons, data%isIn)
object = Surv(data$totalSeasons, data$isIn)
object
km = survfit(object~1)
summary(km)
plot(km, conf.int = TRUE)
cox1 = coxph(object~ weight + height + bats + throws + cAB + cR + cH + cRBI + cSB + cSO, data = managers)
cox1 = coxph(object~ weight + height + bats + throws + cAB + cR + cH + cRBI + cSB + cSO, data = data)
summary(cox1)
plot(survfit(cox1), conf.int = TRUE)
data
plot(km, conf.int = TRUE)
plot(survfit(cox1), conf.int = TRUE)
summary(cox1)
cox2 = coxph(object~ weight + height + bats + throws + cAB + cH + cRBI + cSB + cSO, data = data)
summary(cox2)
plot(survfit(cox1), conf.int = TRUE)
plot(survfit(cox2), conf.int = TRUE)
plot(survfit(cox1), conf.int = TRUE)
plot(survfit(cox2), conf.int = TRUE)
